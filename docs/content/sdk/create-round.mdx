# åˆ›å»ºæŠ•ç¥¨è½®æ¬¡

å­¦ä¹ å¦‚ä½•ä½¿ç”¨ SDK åˆ›å»º MACI æŠ•ç¥¨è½®æ¬¡ã€‚

## åŸºç¡€ç”¨æ³•

åˆ›å»ºä¸€ä¸ªä½¿ç”¨ Oracle ç™½åå•çš„æŠ•ç¥¨è½®æ¬¡ï¼š

```typescript
import { MaciClient, MaciCircuitType } from '@dorafactory/maci-sdk';

const client = new MaciClient({ network: 'testnet' });

const round = await client.createOracleMaciRound({
  signer: wallet,
  operatorPubkey: '0e752c...',  // Operator å…¬é’¥
  
  // æŠ•ç¥¨æ—¶é—´
  startVoting: new Date('2024-02-01T00:00:00Z'),
  endVoting: new Date('2024-02-07T23:59:59Z'),
  
  // è½®æ¬¡ä¿¡æ¯
  title: 'ç¤¾åŒºææ¡ˆæŠ•ç¥¨',
  description: 'æŠ•ç¥¨å†³å®šç¤¾åŒºä¸‹ä¸€æ­¥å‘å±•æ–¹å‘',
  link: 'https://forum.example.com/proposal',
  
  // æŠ•ç¥¨é€‰é¡¹
  voteOptionMap: [
    'ææ¡ˆ A: å¢åŠ ç¤¾åŒºèµ„é‡‘',
    'ææ¡ˆ B: æ”¹è¿›æŠ€æœ¯åŸºç¡€è®¾æ–½',
    'ææ¡ˆ C: æ‰©å¤§å¸‚åœºæ¨å¹¿'
  ],
  
  // æŠ•ç¥¨ç±»å‹
  circuitType: MaciCircuitType.QV,  // äºŒæ¬¡æ–¹æŠ•ç¥¨
  
  // ç™½åå•é…ç½®
  whitelistEcosystem: 'cosmoshub',
  whitelistSnapshotHeight: '0',  // å®æ—¶æŸ¥è¯¢
  whitelistVotingPowerArgs: {
    mode: 'slope',
    slope: '1000000',  // æ¯ 1 ATOM = 1 voice credit
    threshold: '1000000'
  }
});

console.log('Round åˆ›å»ºæˆåŠŸï¼');
console.log('åˆçº¦åœ°å€:', round.contractAddress);
```

## å‚æ•°è¯¦è§£

### å¿…éœ€å‚æ•°

#### signer (Wallet)

ç­¾åäº¤æ˜“çš„é’±åŒ…ï¼š

```typescript
import { DirectSecp256k1Wallet } from '@cosmjs/proto-signing';

const wallet = await DirectSecp256k1Wallet.fromKey(
  Buffer.from(privateKey, 'hex'),
  'dora'
);
```

#### operatorPubkey (string)

Operator çš„å…¬é’¥ï¼ˆåå…­è¿›åˆ¶å­—ç¬¦ä¸²ï¼‰ã€‚ä» Registry åˆçº¦æŸ¥è¯¢ï¼š

```typescript
const pubkey = await client.getOperatorByAddress('dora1operator...');
console.log('Operator å…¬é’¥:', pubkey.pubkey);
```

#### startVoting & endVoting (Date)

æŠ•ç¥¨çš„å¼€å§‹å’Œç»“æŸæ—¶é—´ï¼š

```typescript
// ç«‹å³å¼€å§‹ï¼Œ7 å¤©åç»“æŸ
startVoting: new Date(),
endVoting: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000)

// æŒ‡å®šå…·ä½“æ—¶é—´
startVoting: new Date('2024-02-01T00:00:00Z'),
endVoting: new Date('2024-02-07T23:59:59Z')
```

#### title, description, link (string)

è½®æ¬¡çš„åŸºæœ¬ä¿¡æ¯ï¼š

```typescript
title: 'ç¤¾åŒºææ¡ˆæŠ•ç¥¨',
description: 'è¯¦ç»†æè¿°æŠ•ç¥¨çš„ç›®çš„å’Œè§„åˆ™',
link: 'https://forum.example.com/proposal-123'
```

#### voteOptionMap (string[])

æŠ•ç¥¨é€‰é¡¹åˆ—è¡¨ï¼š

```typescript
voteOptionMap: [
  'é€‰é¡¹ 1: æè¿°',
  'é€‰é¡¹ 2: æè¿°',
  'é€‰é¡¹ 3: æè¿°',
  // å¯ä»¥æœ‰ä»»æ„æ•°é‡çš„é€‰é¡¹
]
```

#### circuitType (MaciCircuitType)

æŠ•ç¥¨ç±»å‹ï¼š

```typescript
import { MaciCircuitType } from '@dorafactory/maci-sdk';

// ä¸€äººä¸€ç¥¨
circuitType: MaciCircuitType.IP1V

// äºŒæ¬¡æ–¹æŠ•ç¥¨
circuitType: MaciCircuitType.QV
```

### ç™½åå•é…ç½®

#### whitelistEcosystem (string)

æ”¯æŒçš„ç”Ÿæ€ç³»ç»Ÿï¼š

```typescript
whitelistEcosystem: 'cosmoshub'  // Cosmos Hub
// æˆ–
whitelistEcosystem: 'doravota'   // Dora Vota
```

#### whitelistSnapshotHeight (string)

å¿«ç…§åŒºå—é«˜åº¦ï¼š

```typescript
// ä½¿ç”¨ç‰¹å®šé«˜åº¦çš„å¿«ç…§
whitelistSnapshotHeight: '23342001'

// ä½¿ç”¨å®æ—¶ä½™é¢ï¼ˆ"0"ï¼‰
whitelistSnapshotHeight: '0'
```

#### whitelistVotingPowerArgs

æŠ•ç¥¨æƒé‡è®¡ç®—å‚æ•°ï¼š

**Slope æ¨¡å¼ï¼š**

```typescript
whitelistVotingPowerArgs: {
  mode: 'slope',
  slope: '1000000',     // é™¤æ•°
  threshold: '1000000'  // æœ€å°è´¨æŠ¼é‡
}

// è®¡ç®—å…¬å¼ï¼švoice_credits = staked_tokens / slope
// ä¾‹å¦‚ï¼šç”¨æˆ·è´¨æŠ¼ 100 ATOM (100000000 uatom)
// voice_credits = 100000000 / 1000000 = 100
```

**Threshold æ¨¡å¼ï¼š**

```typescript
whitelistVotingPowerArgs: {
  mode: 'threshold',
  slope: '0',
  threshold: '1000000'  // æœ€å°è´¨æŠ¼é‡
}

// è´¨æŠ¼é‡ >= threshold çš„ç”¨æˆ·è·å¾— 1 voice credit
// è´¨æŠ¼é‡ < threshold çš„ç”¨æˆ·è·å¾— 0 voice credit
```

## æŠ•ç¥¨ç±»å‹å¯¹æ¯”

### 1P1Vï¼ˆä¸€äººä¸€ç¥¨ï¼‰

æ¯ä¸ª voice credit ç›´æ¥è®¡ä¸º 1 ç¥¨ï¼š

```typescript
circuitType: MaciCircuitType.IP1V

// ç”¨æˆ·æœ‰ 100 voice credits
// æŠ•ç¥¨ï¼š[{ idx: 0, vc: 50 }, { idx: 1, vc: 30 }]
// ç»“æœï¼šé€‰é¡¹ 0 è·å¾— 50 ç¥¨ï¼Œé€‰é¡¹ 1 è·å¾— 30 ç¥¨
// æ¶ˆè€—ï¼š80 voice credits
```

### QVï¼ˆäºŒæ¬¡æ–¹æŠ•ç¥¨ï¼‰

voice credit çš„å¹³æ–¹ä½œä¸ºæ¶ˆè€—ï¼š

```typescript
circuitType: MaciCircuitType.QV

// ç”¨æˆ·æœ‰ 100 voice credits
// æŠ•ç¥¨ï¼š[{ idx: 0, vc: 8 }, { idx: 1, vc: 6 }]
// ç»“æœï¼šé€‰é¡¹ 0 è·å¾— 8 ç¥¨ï¼Œé€‰é¡¹ 1 è·å¾— 6 ç¥¨
// æ¶ˆè€—ï¼š8Â² + 6Â² = 64 + 36 = 100 voice credits
```

## å®Œæ•´ç¤ºä¾‹

### åˆ›å»º 1P1V æŠ•ç¥¨

```typescript
const round1p1v = await client.createOracleMaciRound({
  signer: wallet,
  operatorPubkey: operatorPubkey,
  
  startVoting: new Date(),
  endVoting: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000),
  
  title: 'DAO ææ¡ˆæŠ•ç¥¨ï¼ˆä¸€äººä¸€ç¥¨ï¼‰',
  description: 'æ¯ä¸ªæˆå‘˜ä¸€ç¥¨ï¼Œå¤šæ•°è·èƒœ',
  link: 'https://dao.example.com',
  
  voteOptionMap: ['èµæˆ', 'åå¯¹', 'å¼ƒæƒ'],
  
  circuitType: MaciCircuitType.IP1V,
  
  whitelistEcosystem: 'cosmoshub',
  whitelistSnapshotHeight: '23342001',
  whitelistVotingPowerArgs: {
    mode: 'threshold',
    slope: '0',
    threshold: '1000000'  // è‡³å°‘è´¨æŠ¼ 1 ATOM
  }
});
```

### åˆ›å»º QV æŠ•ç¥¨

```typescript
const roundQV = await client.createOracleMaciRound({
  signer: wallet,
  operatorPubkey: operatorPubkey,
  
  startVoting: new Date(),
  endVoting: new Date(Date.now() + 14 * 24 * 60 * 60 * 1000),
  
  title: 'å…¬å…±ç‰©å“èµ„é‡‘åˆ†é…ï¼ˆäºŒæ¬¡æ–¹æŠ•ç¥¨ï¼‰',
  description: 'ä½¿ç”¨äºŒæ¬¡æ–¹æŠ•ç¥¨åˆ†é…èµ„é‡‘',
  link: 'https://gitcoin.example.com',
  
  voteOptionMap: [
    'é¡¹ç›® A: DeFi å·¥å…·',
    'é¡¹ç›® B: æ•™è‚²å†…å®¹',
    'é¡¹ç›® C: åŸºç¡€è®¾æ–½',
    'é¡¹ç›® D: ç¤¾åŒºæ´»åŠ¨'
  ],
  
  circuitType: MaciCircuitType.QV,
  
  whitelistEcosystem: 'doravota',
  whitelistSnapshotHeight: '0',  // å®æ—¶
  whitelistVotingPowerArgs: {
    mode: 'slope',
    slope: '1000000000000000000',  // 1 DORA (18 decimals)
    threshold: '1000000000000000000'
  }
});
```

## é”™è¯¯å¤„ç†

```typescript
try {
  const round = await client.createOracleMaciRound({
    // ... å‚æ•°
  });
  console.log('âœ… åˆ›å»ºæˆåŠŸ:', round.contractAddress);
} catch (error) {
  if (error.message.includes('Operator not registered')) {
    console.error('âŒ Operator æœªæ³¨å†Œ');
  } else if (error.message.includes('Insufficient funds')) {
    console.error('âŒ ä½™é¢ä¸è¶³');
  } else {
    console.error('âŒ åˆ›å»ºå¤±è´¥:', error);
  }
}
```

## éªŒè¯åˆ›å»º

åˆ›å»ºåéªŒè¯ Round ä¿¡æ¯ï¼š

```typescript
const roundInfo = await client.getRoundById(round.contractAddress);

console.log('Round éªŒè¯:');
console.log('- æ ‡é¢˜:', roundInfo.title);
console.log('- çŠ¶æ€:', roundInfo.status);
console.log('- å¼€å§‹æ—¶é—´:', new Date(roundInfo.votingTime.startTime * 1000));
console.log('- ç»“æŸæ—¶é—´:', new Date(roundInfo.votingTime.endTime * 1000));
console.log('- é€‰é¡¹æ•°é‡:', roundInfo.voteOptionMap.length);
```

## ä¸‹ä¸€æ­¥

Round åˆ›å»ºæˆåŠŸåï¼Œç”¨æˆ·å¯ä»¥ï¼š

- ğŸ“ [å‚ä¸æŠ•ç¥¨](/sdk/voting-guide) - å­¦ä¹ å¦‚ä½•æŠ•ç¥¨
- ğŸ” [æŸ¥è¯¢ä¿¡æ¯](/sdk/query-api) - æŸ¥è¯¢ Round ä¿¡æ¯
- ğŸ’¡ [æŸ¥çœ‹ç¤ºä¾‹](/examples/oracle-round) - å®Œæ•´ç¤ºä¾‹ä»£ç 
