# MACI 投票系统

MACI (Minimal Anti-Collusion Infrastructure) 是一个基于密码学的链上投票系统，专门解决传统电子投票中的串谋、贿选和隐私泄露问题。

## 为什么需要 MACI

传统的链上投票完全公开透明——任何人都能看到谁投了什么票。这导致几个严重问题：

**贿选很容易。** 在 Gitcoin Grants 早期，有人直接发推特："投我的项目，我给你转账。"因为投票记录公开，贿赂者能验证你是否真的投了。

**社交压力普遍存在。** 在 DAO 治理中，如果你投反对票，可能面临社区压力。有些人不敢表达真实想法，因为投票记录永久可查。

**Sybil 攻击防不胜防。** 有人创建大量钱包账户，用每个账户投一票，操纵投票结果。

MACI 通过密码学技术解决这些问题，让投票既可验证又能保护隐私。

## MACI vs AMACI

**MACI** 是第一版实现，提供投票内容加密和抗贿选机制。它的问题是：虽然投票内容加密了，但处理投票的 operator 能通过链上 signup 交易看到"谁投了票"。Operator 能确定 "地址 `dora1abc...` 投给了选项 A"。

**AMACI** (Anonymous MACI) 是当前使用的版本，在 MACI 基础上增加了身份匿名化。即使是 operator 也只能看到"有人投给了选项 A"，但不知道具体是哪个地址。这通过零知识证明技术实现。

## AMACI 的核心机制

### 投票内容加密

所有投票消息用 operator 公钥加密后上链。只有 operator 能解密消息内容，外部观察者完全看不到谁投了什么。

### 身份匿名化

AMACI 提供三种注册方式：

**Signup** 最快捷。直接用你的钱包地址注册，适合公开投票场景。缺点是 operator 能看到你的地址。

**Add-new-key** 完全匿名。通过零知识证明创建新身份，operator 无法关联到你的原始地址。需要等待 operator 处理 deactivate 消息，通常几小时。

**Pre-add-new-key** 兼具匿名性和速度。投票组织者预先配置好匿名集，你可以立即匿名注册。

### 防贿选机制

MACI 允许你随时更换密钥。即使你接受了贿赂，用旧密钥投票给贿赂者，你仍然可以：

1. 秘密更换密钥
2. 用新密钥重新投票
3. 只有最后一次投票有效

贿赂者无法验证你的最终投票。如果你使用 add-new-key 匿名注册，贿赂者连贿赂目标都找不到。

### 零知识证明

Operator 处理投票后，必须生成零知识证明，证明自己：
- 没有篡改任何投票
- 没有遗漏任何投票
- 正确统计了结果

任何人都可以验证这个证明。Operator 无法作弊。

## 工作流程

一次完整的 AMACI 投票流程：

**创建投票。** 投票组织者选择一个注册的 operator，配置投票选项、时间、参与资格等，通过 Registry 合约一键创建投票实例。

**用户注册。** 根据隐私需求选择 signup、add-new-key 或 pre-add-new-key 方式注册。

**提交投票。** 投票消息在本地加密，然后提交到链上。可以多次投票，最后一次有效。

**Operator 处理。** 投票期结束后，operator 下载所有加密消息，解密处理，生成零知识证明。

**链上验证。** 智能合约验证 operator 提交的证明，验证通过后公布结果。

## 关键设计权衡

**Operator 依赖。** AMACI 使用许可制的专业 operator 网络。Operator 能看到投票内容（但使用 add-new-key 时不知道是谁投的），也可能拒绝处理投票。这是用易用性换隐私的设计：用户无需自己运行复杂的 operator 软件，零知识证明确保 operator 无法作恶。

**处理延迟。** 结果不是实时的。Operator 需要时间处理消息和生成证明（通常几小时内完成）。这是隐私保护的必要代价。

**Gas 成本。** 验证零知识证明需要较多链上计算。AMACI 通过 Gas Station 补贴用户交易费用，创建投票时支付 operator 服务费。

## 适用场景

AMACI 适合需要强隐私保护和抗串谋的投票：

- **DAO 治理** - 协议参数调整、资金分配决策，避免社交压力和大户操纵
- **二次方融资** - Gitcoin Grants 类型的公共物品资助，防止贿选和共谋
- **组织选举** - 内部选举或代表选举，保护投票隐私
- **代币加权投票** - 基于代币持有量的治理投票，支持快照和跨链

## 技术栈

AMACI 是一套完整的技术栈：

- 智能合约 (Rust/CosmWasm) - 部署在 Cosmos 链上
- 零知识电路 (Circom) - 生成和验证证明
- 密码学库 - EdDSA 签名、Poseidon 加密
- TypeScript SDK - 方便开发者集成
- Operator 网络 - 许可制的专业节点

## 下一步

**想快速体验？** 查看[快速开始指南](/docs/introduction/quick-start)，五分钟创建第一个投票。

**想了解技术细节？** 阅读[协议概览](/docs/protocol/overview)，深入理解 AMACI 工作原理。

**想集成到应用？** 参考 [SDK 文档](/docs/sdk/installation)和[完整示例](/docs/examples/basic-voting)。
