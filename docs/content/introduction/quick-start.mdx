# å¿«é€Ÿå¼€å§‹

æœ¬æŒ‡å—å°†å¸®åŠ©æ‚¨åœ¨ 5 åˆ†é’Ÿå†…åˆ›å»ºç¬¬ä¸€ä¸ª MACI æŠ•ç¥¨ã€‚æˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªç®€å•çš„äºŒæ¬¡æ–¹æŠ•ç¥¨è½®æ¬¡ï¼Œå¹¶å®Œæˆä¸€æ¬¡æŠ•ç¥¨ã€‚

## å‰ç½®è¦æ±‚

åœ¨å¼€å§‹ä¹‹å‰ï¼Œè¯·ç¡®ä¿æ‚¨å·²å®‰è£…ï¼š

- **Node.js** 16 æˆ–æ›´é«˜ç‰ˆæœ¬
- **npm** æˆ– **pnpm** åŒ…ç®¡ç†å™¨
- ä¸€ä¸ª Cosmos é’±åŒ…çš„ç§é’¥ï¼ˆç”¨äºæµ‹è¯•ï¼‰

## æ­¥éª¤ 1: å®‰è£… SDK

é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ªæ–°é¡¹ç›®å¹¶å®‰è£… MACI SDKï¼š

```bash
# åˆ›å»ºé¡¹ç›®ç›®å½•
mkdir my-maci-app
cd my-maci-app

# åˆå§‹åŒ–é¡¹ç›®
npm init -y

# å®‰è£… MACI SDK
npm install @dorafactory/maci-sdk

# å®‰è£…å…¶ä»–ä¾èµ–
npm install @cosmjs/proto-signing @cosmjs/stargate
```

## æ­¥éª¤ 2: åˆå§‹åŒ–å®¢æˆ·ç«¯

åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶ `index.js` å¹¶æ·»åŠ ä»¥ä¸‹ä»£ç ï¼š

```javascript
import { MaciClient, MaciCircuitType } from '@dorafactory/maci-sdk';
import { DirectSecp256k1Wallet } from '@cosmjs/proto-signing';

// åˆå§‹åŒ– MACI å®¢æˆ·ç«¯
const client = new MaciClient({
  network: 'testnet', // ä½¿ç”¨æµ‹è¯•ç½‘
});

console.log('MACI å®¢æˆ·ç«¯åˆå§‹åŒ–æˆåŠŸï¼');
```

## æ­¥éª¤ 3: é…ç½®é’±åŒ…

æ·»åŠ é’±åŒ…é…ç½®ï¼ˆè¯·ä½¿ç”¨æµ‹è¯•ç½‘é’±åŒ…ï¼‰ï¼š

```javascript
// è­¦å‘Šï¼šä¸è¦åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ç¡¬ç¼–ç ç§é’¥ï¼
const PRIVATE_KEY = 'your-private-key-hex';
const PREFIX = 'dora';

async function setupWallet() {
  const wallet = await DirectSecp256k1Wallet.fromKey(
    Buffer.from(PRIVATE_KEY, 'hex'),
    PREFIX
  );
  
  const [account] = await wallet.getAccounts();
  console.log('é’±åŒ…åœ°å€:', account.address);
  
  return { wallet, address: account.address };
}
```

## æ­¥éª¤ 4: åˆ›å»ºæŠ•ç¥¨è½®æ¬¡

ç°åœ¨è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªç®€å•çš„æŠ•ç¥¨è½®æ¬¡ï¼š

```javascript
async function createVotingRound() {
  const { wallet, address } = await setupWallet();
  
  // Operator å…¬é’¥ï¼ˆé€šå¸¸ç”± Operator æä¾›ï¼‰
  // è¿™é‡Œä½¿ç”¨ç¤ºä¾‹å…¬é’¥
  const operatorPubkey = '0e752c8f4c4c9f5c4e8a3d2c1b0a9e8d7c6b5a4f3e2d1c0b9a8e7d6c5b4a3f2e';
  
  try {
    console.log('æ­£åœ¨åˆ›å»ºæŠ•ç¥¨è½®æ¬¡...');
    
    const round = await client.createOracleMaciRound({
      signer: wallet,
      operatorPubkey,
      
      // æŠ•ç¥¨æ—¶é—´
      startVoting: new Date(),
      endVoting: new Date(Date.now() + 24 * 60 * 60 * 1000), // 24å°æ—¶å
      
      // è½®æ¬¡ä¿¡æ¯
      title: 'ç¤¾åŒºææ¡ˆæŠ•ç¥¨',
      description: 'é€‰æ‹©æ‚¨æœ€å–œæ¬¢çš„ç¤¾åŒºææ¡ˆ',
      link: 'https://example.com',
      
      // æŠ•ç¥¨é€‰é¡¹
      voteOptionMap: [
        'ææ¡ˆ A: å¢åŠ ç¤¾åŒºèµ„é‡‘',
        'ææ¡ˆ B: æ”¹è¿›æŠ€æœ¯åŸºç¡€è®¾æ–½',
        'ææ¡ˆ C: æ‰©å¤§å¸‚åœºæ¨å¹¿',
      ],
      
      // æŠ•ç¥¨ç±»å‹
      circuitType: MaciCircuitType.QV, // äºŒæ¬¡æ–¹æŠ•ç¥¨
      
      // ç™½åå•é…ç½®
      whitelistEcosystem: 'cosmoshub',
      whitelistSnapshotHeight: '0', // ä½¿ç”¨å®æ—¶ä½™é¢
      whitelistVotingPowerArgs: {
        mode: 'slope',
        slope: '1000000', // æ¯ 1 ATOM = 1 voice credit
        threshold: '1000000',
      },
    });
    
    console.log('âœ… æŠ•ç¥¨è½®æ¬¡åˆ›å»ºæˆåŠŸï¼');
    console.log('åˆçº¦åœ°å€:', round.contractAddress);
    
    return round.contractAddress;
  } catch (error) {
    console.error('åˆ›å»ºå¤±è´¥:', error);
    throw error;
  }
}
```

## æ­¥éª¤ 5: å‚ä¸æŠ•ç¥¨

åˆ›å»ºæŠ•ç¥¨åï¼Œè®©æˆ‘ä»¬è¿›è¡ŒæŠ•ç¥¨ï¼š

```javascript
async function participateInVoting(contractAddress) {
  const { wallet, address } = await setupWallet();
  
  try {
    // 5.1 ç”Ÿæˆ MACI è´¦æˆ·
    console.log('æ­£åœ¨ç”Ÿæˆ MACI è´¦æˆ·...');
    const maciAccount = await client.circom.genKeypairFromSign(wallet, address);
    console.log('âœ… MACI è´¦æˆ·ç”ŸæˆæˆåŠŸ');
    
    // 5.2 è·å– Oracle è¯ä¹¦
    console.log('æ­£åœ¨è·å–æŠ•ç¥¨èµ„æ ¼è¯ä¹¦...');
    const certificate = await client.maci.requestOracleCertificate({
      signer: wallet,
      ecosystem: 'cosmoshub',
      address,
      contractAddress,
    });
    console.log('âœ… è¯ä¹¦è·å–æˆåŠŸï¼ŒæŠ•ç¥¨æƒé‡:', certificate.amount);
    
    // 5.3 ç­‰å¾… Gas Station å¯ç”¨
    console.log('æ­£åœ¨ç­‰å¾… Gas Station...');
    let hasFeegrant = false;
    let attempts = 0;
    const maxAttempts = 30;
    
    while (!hasFeegrant && attempts < maxAttempts) {
      hasFeegrant = await client.maci.hasFeegrant({
        address,
        contractAddress,
      });
      
      if (!hasFeegrant) {
        await new Promise(resolve => setTimeout(resolve, 2000));
        attempts++;
      }
    }
    
    if (!hasFeegrant) {
      console.warn('âš ï¸  Gas Station æœªå¯ç”¨ï¼Œå°†ä½¿ç”¨è‡ªå·±çš„ Gas');
    } else {
      console.log('âœ… Gas Station å·²å¯ç”¨');
    }
    
    // 5.4 ç­¾åˆ°
    console.log('æ­£åœ¨ç­¾åˆ°...');
    await client.maci.signup({
      signer: wallet,
      address,
      contractAddress,
      maciAccount,
      oracleCertificate: {
        amount: certificate.amount,
        signature: certificate.signature,
      },
      gasStation: hasFeegrant,
    });
    console.log('âœ… ç­¾åˆ°æˆåŠŸ');
    
    // 5.5 æŠ•ç¥¨
    console.log('æ­£åœ¨æŠ•ç¥¨...');
    
    // è·å– Operator å…¬é’¥
    const roundInfo = await client.getRoundById(contractAddress);
    
    await client.maci.vote({
      signer: wallet,
      address,
      contractAddress,
      selectedOptions: [
        { idx: 0, vc: 5 }, // ç»™ææ¡ˆ A æŠ• 5 ç¥¨ï¼ˆæ¶ˆè€— 25 voice creditsï¼‰
        { idx: 1, vc: 3 }, // ç»™ææ¡ˆ B æŠ• 3 ç¥¨ï¼ˆæ¶ˆè€— 9 voice creditsï¼‰
        { idx: 2, vc: 2 }, // ç»™ææ¡ˆ C æŠ• 2 ç¥¨ï¼ˆæ¶ˆè€— 4 voice creditsï¼‰
      ], // æ€»å…±æ¶ˆè€— 38 voice creditsï¼ˆQV æ¨¡å¼ï¼‰
      operatorCoordPubKey: [
        BigInt(roundInfo.coordinatorPubkeyX),
        BigInt(roundInfo.coordinatorPubkeyY),
      ],
      maciAccount,
      gasStation: hasFeegrant,
    });
    
    console.log('âœ… æŠ•ç¥¨æˆåŠŸï¼');
    console.log('æ‚¨å·²æˆåŠŸæŠ•ç¥¨ï¼');
  } catch (error) {
    console.error('æŠ•ç¥¨å¤±è´¥:', error);
    throw error;
  }
}
```

## æ­¥éª¤ 6: è¿è¡Œå®Œæ•´ç¤ºä¾‹

å°†æ‰€æœ‰ä»£ç æ•´åˆåˆ°ä¸€èµ·ï¼š

```javascript
async function main() {
  try {
    // åˆ›å»ºæŠ•ç¥¨è½®æ¬¡
    const contractAddress = await createVotingRound();
    
    // ç­‰å¾…å‡ ç§’è®©åˆçº¦åˆå§‹åŒ–
    console.log('\nç­‰å¾…åˆçº¦åˆå§‹åŒ–...');
    await new Promise(resolve => setTimeout(resolve, 5000));
    
    // å‚ä¸æŠ•ç¥¨
    console.log('\nå¼€å§‹å‚ä¸æŠ•ç¥¨...');
    await participateInVoting(contractAddress);
    
    console.log('\nğŸ‰ å®Œæˆï¼æ‚¨å·²æˆåŠŸåˆ›å»ºå¹¶å‚ä¸äº†ç¬¬ä¸€ä¸ª MACI æŠ•ç¥¨ï¼');
  } catch (error) {
    console.error('å‘ç”Ÿé”™è¯¯:', error);
  }
}

// è¿è¡Œä¸»å‡½æ•°
main();
```

## æ­¥éª¤ 7: æ‰§è¡Œä»£ç 

åœ¨é¡¹ç›®ç›®å½•ä¸­è¿è¡Œï¼š

```bash
node index.js
```

æ‚¨åº”è¯¥çœ‹åˆ°ç±»ä¼¼ä»¥ä¸‹çš„è¾“å‡ºï¼š

```
MACI å®¢æˆ·ç«¯åˆå§‹åŒ–æˆåŠŸï¼
é’±åŒ…åœ°å€: dora1...
æ­£åœ¨åˆ›å»ºæŠ•ç¥¨è½®æ¬¡...
âœ… æŠ•ç¥¨è½®æ¬¡åˆ›å»ºæˆåŠŸï¼
åˆçº¦åœ°å€: dora1...

ç­‰å¾…åˆçº¦åˆå§‹åŒ–...

å¼€å§‹å‚ä¸æŠ•ç¥¨...
æ­£åœ¨ç”Ÿæˆ MACI è´¦æˆ·...
âœ… MACI è´¦æˆ·ç”ŸæˆæˆåŠŸ
æ­£åœ¨è·å–æŠ•ç¥¨èµ„æ ¼è¯ä¹¦...
âœ… è¯ä¹¦è·å–æˆåŠŸï¼ŒæŠ•ç¥¨æƒé‡: 100
æ­£åœ¨ç­‰å¾… Gas Station...
âœ… Gas Station å·²å¯ç”¨
æ­£åœ¨ç­¾åˆ°...
âœ… ç­¾åˆ°æˆåŠŸ
æ­£åœ¨æŠ•ç¥¨...
âœ… æŠ•ç¥¨æˆåŠŸï¼

ğŸ‰ å®Œæˆï¼æ‚¨å·²æˆåŠŸåˆ›å»ºå¹¶å‚ä¸äº†ç¬¬ä¸€ä¸ª MACI æŠ•ç¥¨ï¼
```

## ç†è§£æŠ•ç¥¨æƒé‡è®¡ç®—

åœ¨äºŒæ¬¡æ–¹æŠ•ç¥¨ï¼ˆQVï¼‰æ¨¡å¼ä¸‹ï¼š

```javascript
// å‡è®¾æ‚¨æœ‰ 100 voice credits
const totalVoiceCredits = 100;

// æ‚¨çš„æŠ•ç¥¨
const votes = [
  { idx: 0, vc: 5 },  // 5Â² = 25 credits
  { idx: 1, vc: 3 },  // 3Â² = 9 credits
  { idx: 2, vc: 2 },  // 2Â² = 4 credits
];

// æ€»æ¶ˆè€— = 25 + 9 + 4 = 38 credits
// å‰©ä½™ = 100 - 38 = 62 credits
```

åœ¨ä¸€äººä¸€ç¥¨ï¼ˆ1P1Vï¼‰æ¨¡å¼ä¸‹ï¼š

```javascript
// å‡è®¾æ‚¨æœ‰ 100 voice credits
const totalVoiceCredits = 100;

// æ‚¨çš„æŠ•ç¥¨
const votes = [
  { idx: 0, vc: 50 },  // ç›´æ¥æ¶ˆè€— 50 credits
  { idx: 1, vc: 30 },  // ç›´æ¥æ¶ˆè€— 30 credits
  { idx: 2, vc: 20 },  // ç›´æ¥æ¶ˆè€— 20 credits
];

// æ€»æ¶ˆè€— = 50 + 30 + 20 = 100 credits
```

## å¸¸è§é—®é¢˜

### Q: æˆ‘å¯ä»¥ä¿®æ”¹æˆ‘çš„æŠ•ç¥¨å—ï¼Ÿ

**A:** å¯ä»¥ï¼åªéœ€å†æ¬¡è°ƒç”¨ `vote()` å‡½æ•°ï¼Œæ–°çš„æŠ•ç¥¨ä¼šè¦†ç›–æ—§çš„æŠ•ç¥¨ã€‚

```javascript
// ç¬¬ä¸€æ¬¡æŠ•ç¥¨
await client.maci.vote({
  selectedOptions: [{ idx: 0, vc: 5 }],
  // ... å…¶ä»–å‚æ•°
});

// æ”¹å˜ä¸»æ„ï¼Œé‡æ–°æŠ•ç¥¨
await client.maci.vote({
  selectedOptions: [{ idx: 1, vc: 5 }],
  // ... å…¶ä»–å‚æ•°
});
```

### Q: å¦‚ä½•æŸ¥çœ‹æŠ•ç¥¨ç»“æœï¼Ÿ

**A:** æŠ•ç¥¨ç»“æŸåï¼ŒOperator ä¼šå¤„ç†æ¶ˆæ¯å¹¶å‘å¸ƒç»“æœã€‚æ‚¨å¯ä»¥æŸ¥è¯¢åˆçº¦è·å–ç»“æœï¼š

```javascript
const round = await client.getRoundById(contractAddress);
console.log('æŠ•ç¥¨çŠ¶æ€:', round.status);
console.log('æŠ•ç¥¨ç»“æœ:', round.results);
```

### Q: ä¸ºä»€ä¹ˆéœ€è¦ç­‰å¾… Gas Stationï¼Ÿ

**A:** Gas Station æä¾›è´¹ç”¨è¡¥è´´ï¼Œè®©ç”¨æˆ·æ— éœ€æŒæœ‰åŸç”Ÿä»£å¸å³å¯å‚ä¸æŠ•ç¥¨ã€‚å¦‚æœä¸ç­‰å¾…ï¼Œæ‚¨éœ€è¦ç¡®ä¿é’±åŒ…æœ‰è¶³å¤Ÿçš„ä½™é¢æ”¯ä»˜ Gas è´¹ç”¨ã€‚

### Q: Operator å…¬é’¥ä»å“ªé‡Œè·å–ï¼Ÿ

**A:** Operator å…¬é’¥é€šå¸¸ç”±è¿è¡Œ Operator ç³»ç»Ÿçš„ç»„ç»‡æä¾›ã€‚æ‚¨å¯ä»¥ï¼š
- ä» Registry åˆçº¦æŸ¥è¯¢å·²æ³¨å†Œçš„ Operator
- è”ç³»æŠ•ç¥¨ç»„ç»‡è€…è·å–
- ä½¿ç”¨é»˜è®¤çš„ Operatorï¼ˆæµ‹è¯•ç½‘ï¼‰

## ä¸‹ä¸€æ­¥

æ­å–œï¼æ‚¨å·²ç»æˆåŠŸåˆ›å»ºå¹¶å‚ä¸äº†ç¬¬ä¸€ä¸ª MACI æŠ•ç¥¨ã€‚æ¥ä¸‹æ¥æ‚¨å¯ä»¥ï¼š

- ğŸ“– [æ·±å…¥äº†è§£åè®®](/protocol/overview) - å­¦ä¹  MACI çš„å·¥ä½œåŸç†
- ğŸ”§ [æ¢ç´¢ SDK API](/sdk/installation) - äº†è§£æ›´å¤š SDK åŠŸèƒ½
- ğŸ’¼ [æŸ¥çœ‹å®Œæ•´ç¤ºä¾‹](/examples/basic-voting) - å­¦ä¹ æ›´å¤æ‚çš„ä½¿ç”¨åœºæ™¯
- ğŸ—ï¸ [äº†è§£åˆçº¦è®¾è®¡](/contracts/architecture) - ç†è§£ç³»ç»Ÿæ¶æ„

## é¢å¤–èµ„æº

- [SDK GitHub ä»“åº“](https://github.com/DoraFactory/maci)
- [ç¤ºä¾‹ä»£ç ](https://github.com/DoraFactory/maci/tree/main/packages/sdk/examples)
- [API æ–‡æ¡£](/sdk/query-api)

## è·å–å¸®åŠ©

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œæ‚¨å¯ä»¥ï¼š

- æŸ¥çœ‹[å¸¸è§é—®é¢˜](/faq)
- åœ¨ [GitHub](https://github.com/DoraFactory/maci/issues) ä¸Šæäº¤ Issue
- åŠ å…¥æˆ‘ä»¬çš„ç¤¾åŒºè®¨è®º
